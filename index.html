<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Générateur de Menus</title>
  <meta name="theme-color" content="#6750A4">

  <link rel="manifest" href="./manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div>
        <div class="title">Générateur de Menus</div>
        <div class="subtitle">Planifiez vos repas en équipe</div>
      </div>
      <div id="syncBadge" class="sync-badge hidden">
        <span class="material-icons">sync</span>
        <div>
          <div class="sync-text" id="syncStatus">Synchronisé</div>
          <div id="groupIdDisplay" class="group-id-text"></div>
        </div>
      </div>
    </header>

    <!-- Group setup -->
    <section id="groupSetup" class="card center-column">
      <div class="card-title"><span class="material-icons">group</span> Configuration du groupe</div>
      <p class="info-text">Créez un nouveau groupe ou rejoignez un groupe existant pour synchroniser vos données.</p>

      <div class="button-grid" style="margin-top:8px">
        <button class="btn btn-filled" onclick="createGroup()">Créer un groupe</button>
        <button class="btn btn-filled-tonal" onclick="showJoinBox()">Rejoindre un groupe</button>
      </div>

      <!-- Champ d'entrée caché tant que l'utilisateur ne clique pas sur 'Rejoindre un groupe' -->
      <div id="joinGroupBox" class="join-box hidden">
        <input id="groupIdInput" class="input" placeholder="Entrez l'ID du groupe (ex: group_1234)" />
        <div class="button-grid small">
          <button class="btn btn-filled" onclick="joinGroupConfirm()">Valider</button>
          <button class="btn btn-text" onclick="hideJoinBox()">Annuler</button>
        </div>
      </div>
    </section>

    <!-- Main application -->
    <main id="mainApp" class="hidden">
      <div class="top-controls">
        <div class="button-grid" style="flex:1">
          <button class="btn btn-filled-tonal" onclick="openModal('configModal')">
            <span class="material-icons">settings</span>
            Config
          </button>
          <button class="btn btn-filled" onclick="generateMenu()">
            <span class="material-icons">refresh</span>
            Générer
          </button>
          <button class="btn btn-outlined" onclick="openModal('addRecipeModal')">
            <span class="material-icons">add</span>
            Ajouter une recette
          </button>
        </div>

        <button class="btn btn-text" onclick="openModal('groupModal')" style="align-self:flex-start">
          <span class="material-icons">settings</span> Paramètres du groupe
        </button>
      </div>

      <!-- Recipes list -->
      <section id="recipesList" class="card">
        <div class="card-title">
          <span class="material-icons">restaurant_menu</span> Mes recettes
        </div>
        <div id="recipesContainer" class="list-container">
          <!-- rempli dynamiquement -->
        </div>
      </section>

      <!-- Menus -->
      <section id="menusList" class="card">
        <div class="card-title">
          <span class="material-icons">calendar_today</span> Menus
        </div>
        <div id="menusContainer" class="list-container"></div>
      </section>
    </main>
  </div>

  <!-- Modale: Configuration -->
  <div id="configModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="configTitle">
    <div class="modal-content">
      <div class="modal-title" id="configTitle">Configuration</div>

      <label class="label">Jours de sport (multi-sélection)</label>
      <div id="sportDaysChips" class="chip-container"></div>

      <label class="label">Durée déjeuner (sélection unique)</label>
      <div class="chip-container">
        <div class="chip single" id="lunch1" onclick="setMealDuration('lunch',1)">1 jour</div>
        <div class="chip single" id="lunch2" onclick="setMealDuration('lunch',2)">2 jours</div>
      </div>

      <label class="label">Durée dîner (sélection unique)</label>
      <div class="chip-container">
        <div class="chip single" id="dinner1" onclick="setMealDuration('dinner',1)">1 jour</div>
        <div class="chip single" id="dinner2" onclick="setMealDuration('dinner',2)">2 jours</div>
      </div>

      <div class="modal-buttons">
        <button class="btn btn-filled" onclick="closeModal('configModal')">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Modale: Add recipe -->
  <div id="addRecipeModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="addRecipeTitle">
    <div class="modal-content">
      <div class="modal-title" id="addRecipeTitle">Ajouter une recette</div>

      <input id="recipeName" class="input" placeholder="Nom du plat" />
      <label class="label">Saisons</label>
      <div id="seasonsChips" class="chip-container"></div>

      <div class="checkboxes">
        <label class="checkbox"><input type="checkbox" id="recipeSportDay"> Jour de sport</label>
        <label class="checkbox"><input type="checkbox" id="recipeVegetarian"> Végétarien</label>
        <label class="checkbox"><input type="checkbox" id="recipeGrill"> Grillades</label>
      </div>

      <div class="modal-buttons">
        <button class="btn btn-text" onclick="closeModal('addRecipeModal')">Annuler</button>
        <button class="btn btn-filled" onclick="addRecipe()">Ajouter</button>
      </div>
    </div>
  </div>

  <!-- Modale: Group -->
  <div id="groupModal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-content">
      <div class="modal-title">Paramètres du groupe</div>
      <label class="label">ID du groupe</label>
      <div class="group-id-display" id="currentGroupId"></div>
      <div class="modal-buttons">
        <button class="btn btn-error" onclick="leaveGroup()">Quitter le groupe</button>
        <button class="btn btn-filled" onclick="closeModal('groupModal')">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <script src="./app.js"></script>
</body>
</html>